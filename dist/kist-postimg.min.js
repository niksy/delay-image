/*! kist-postimg 0.1.2 - Load images via postpone or lazyload method. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a,b){var c={},d="KistPostimg",e="KistPostimg",f="kist.postimg",g=function(b,c){this._element=b,this.settings=a.extend({},this.defaults,c)};c.defaults={threshold:300,scrollTimeout:300,loadType:"postpone"},c.domRefs={windowEl:a(b)},c.init=function(){return this.checkPostImgStateDfd=a.Deferred(),this.getDomRefs(),a.when(this.checkPostImgState()).done(a.proxy(function(){this.bindUiActions(),this.fetchPostponedImages(),this.fetchLazyLoadedImages()},this)),this},c.getDomRefs=function(){this.domRefs=a.extend({},this.domRefs),this.domRefs.imagesEl=a(this._element)},c.bindUiActions=function(){this.domRefs.windowEl.on("scroll."+f,a.debounce(this.settings.scrollTimeout,a.proxy(this.fetchPostponedImages,this))),this.domRefs.windowEl.on("resize."+f,a.debounce(this.settings.scrollTimeout,a.proxy(this.fetchPostponedImages,this)))},c.checkPostImgState=function(){return this.domRefs.imagesEl=this.domRefs.imagesEl.filter(function(){return Boolean(a(this).data("isPostImgAlreadySet"))===!1}),this.domRefs.imagesEl.data("isPostImgAlreadySet",!0).addClass(e),0!==this.domRefs.imagesEl.length?this.checkPostImgStateDfd.resolve():this.checkPostImgStateDfd.reject(),this.checkPostImgStateDfd.promise()},c.fetchPostponedImages=function(){"postpone"===this.settings.loadType&&this.parseImages(this.domRefs.imagesEl.KistInView("getElementsInView",this.settings.threshold))},c.fetchLazyLoadedImages=function(){"lazyload"===this.settings.loadType&&this.parseImages(this.domRefs.imagesEl)},c.parseImages=function(b){b.each(a.proxy(function(b,c){var d=a(c);a.loadImage(d.data("src")).done(a.proxy(function(){d.attr("src",d.data("src")).attr("alt",d.data("alt")).removeAttr("width").removeAttr("height").addClass(e+"--is-loaded"),this.domRefs.imagesEl=this.domRefs.imagesEl.not(d)},this))},this))},a.extend(g.prototype,c),a[d]={},a[d].instances=[],a[d].defaults=g.prototype.defaults,a[d].fetchAllImages=function(){a.each(this.instances,function(a,b){b.fetchPostponedImages(),b.fetchLazyLoadedImages()})},a.fn[d]=function(b){return a[d].instances.push(new g(this,b).init()),this}}(jQuery,window,document);