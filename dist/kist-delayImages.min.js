/*! kist-delayImages 0.3.8 - Delay images via postpone or lazyload. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a,b,c){function d(a){return"object"==typeof a?a:{}}function e(a){return"postpone"===a.method?n?g:h:g}function f(a){j.cb.call(this,"success",[a])}function g(b,c){this.element=b,this.options=a.extend({},this.defaults,c),l.setup.call(this),m.setup.call(this),k.setup.call(this),this.parse(this.dom.el).done(a.proxy(this._init,this))}function h(){h._super.constructor.apply(this,arguments)}function i(){}var j={name:"delayImages",ns:{css:"kist-DelayImages",event:".kist.delayImages"},error:function(a){throw new Error(j.name+": "+a)}};j.classes={image:j.ns.css+"-image",isLoading:"is-loading",isLoaded:"is-loaded"},j.publicMethods=["destroy"],j.cb=function(a,b){this.options[a]&&this.options[a].apply(this._element||this.element,b),k.common.document.trigger((j.name+a).toLowerCase(),b)};var k={common:{document:a(c)},setup:function(){this.dom=this.dom||{},this.dom.el=a(this.element),this._element=this.dom.el.toArray(),this.dom.el.addClass(j.classes.image)},destroy:function(){a.each(j.classes,a.proxy(function(a,b){this.dom.el.removeClass(b)},this))}},l={id:0,setup:function(){this.instance=this.instance||{},this.instance.id=l.id++,this.instance.ens=j.ns.event+"."+this.instance.id},destroy:function(){this.dom.el.each(function(b,c){delete a.data(c)[j.name]})}},m={setup:function(){this.aux=this.aux||{},this.aux.loadImage=a.kist.loader.loadImage}},n="Modernizr"in b&&Modernizr.proxybrowser||/Opera Mini|Silk/i.test(navigator.userAgent);a.extend(g.prototype,{_init:function(a){f.call(this,a)},parse:function(c){j.cb.call(this,"start",[c]);var d=[],e=a.Deferred();return c.addClass(j.classes.isLoading),c.each(a.proxy(function(b,c){c=a(c),d.push(this.aux.loadImage(c.data("src"))),d[d.length-1].always(a.proxy(this.success,this,c))},this)),a.when.apply(b,d).always(function(){e.resolve(c)}),e.promise()},success:function(a){a.attr({src:a.data("src"),alt:a.data("alt")}).removeClass(j.classes.isLoading).addClass(j.classes.isLoaded)},destroy:function(){k.destroy.call(this),l.destroy.call(this)},defaults:{success:function(){},start:function(){}}}),i.prototype=g.prototype,h.prototype=new i,h.prototype.constructor=h,h._super=g.prototype,a.extend(h.prototype,{_init:function(){},parse:function(b){return b.inView({threshold:this.options.threshold,debounce:this.options.debounce,once:a.proxy(function(b){h._super.parse.call(this,b).done(a.proxy(f,this))},this)}),a.Deferred().resolve().promise()},destroy:function(){h._super.destroy.call(this),this.dom.el.inView("destroy")},defaults:a.extend({},h._super.defaults,{threshold:0,debounce:300})}),a.kist=a.kist||{},a.kist[j.name]={lazyload:{defaults:g.prototype.defaults},postpone:{defaults:h.prototype.defaults}},a.fn[j.name]=function(b){if("string"==typeof b&&-1!==a.inArray(b,j.publicMethods))return this.each(function(){var c=a.data(this,j.name);c&&c[b]()});b=d(b);var c=e(b),f=this.filter(function(){return!a.data(this,j.name)&&a(this).is("img")});return f.length&&f.data(j.name,new c(f,b)),this}}(jQuery,window,document);