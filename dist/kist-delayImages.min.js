/*! kist-delayImages 0.3.3 - Delay images via postpone or lazyload. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a,b){function c(b,c){var d={};switch(typeof b){case"string":d.method=b;break;case"object":a.extend(d,b);break;default:d.method="lazyload"}switch(typeof c){case"object":a.extend(d,c);break;case"function":d.success=c}return d}function d(a){switch(a.method){case"lazyload":return f;case"postpone":return g;default:i.error('Unsupported method "'+a.method+'".')}}function e(a){switch(a.method){case"lazyload":a={};break;case"postpone":delete a.method}return a}function f(b,c){this.element=b,this.options=a.extend({},this.defaults,c),k.setup.call(this),l.setup.call(this),j.setup.call(this),this.parse(this.dom.el)}function g(){g._super.constructor.apply(this,arguments)}function h(){}var i={name:"delayImages",ns:{css:"kist-DelayImages",event:".kist.delayImages"},error:function(a){throw new Error(i.name+": "+a)}};i.classes={image:i.ns.css+"-image",isLoading:"is-loading",isLoaded:"is-loaded"},i.publicMethods=["destroy"];var j={setup:function(){this.dom=this.dom||{},this.dom.el=a(this.element),this._element=this.dom.el.toArray(),this.dom.el.addClass(i.classes.image)},destroy:function(){a.each(i.classes,a.proxy(function(a,b){this.dom.el.removeClass(b)},this))}},k={id:0,setup:function(){this.instance=this.instance||{},this.instance.id=k.id++,this.instance.ens=i.ns.event+"."+this.instance.id},destroy:function(){this.dom.el.each(function(b,c){delete a.data(c)[i.name]})}},l={setup:function(){this.aux=this.aux||{},this.aux.loadImage=a.kist.loader.loadImage}};a.extend(f.prototype,{parse:function(c){var d=[],e=a.Deferred();return c.addClass(i.classes.isLoading),c.each(a.proxy(function(b,c){var e;c=a(c),e=this.aux.loadImage(c.data("src")),d.push(e),e.always(a.proxy(this.success,this,c))},this)),a.when.apply(b,d).always(e.resolve),e.promise()},success:function(a){a.attr({src:a.data("src"),alt:a.data("alt")}).removeClass(i.classes.isLoading).addClass(i.classes.isLoaded)},destroy:function(){j.destroy.call(this),k.destroy.call(this)}}),h.prototype=f.prototype,g.prototype=new h,g.prototype.constructor=g,g._super=f.prototype,a.extend(g.prototype,{parse:function(b){b.inView({threshold:this.options.threshold,debounce:this.options.debounce,once:a.proxy(function(b){this.options.start&&this.options.start.call(this._element,b),g._super.parse.call(this,b).done(a.proxy(function(){this.options.success&&this.options.success.call(this._element,b)},this))},this)})},destroy:function(){g._super.destroy.call(this),this.dom.el.inView("destroy")},defaults:{threshold:0,debounce:300,success:null,start:null}}),a.kist=a.kist||{},a.kist[i.name]={postpone:{defaults:g.prototype.defaults}},a.fn[i.name]=function(b,f){var g;if("string"==typeof b&&-1!==a.inArray(b,i.publicMethods))return this.each(function(){var c=a.data(this,i.name);c&&c[b]()});f=c(b,f),g=d(f),f=e(f);var h=this.filter(function(){return!a.data(this,i.name)&&a(this).is("img")});return h.length&&h.data(i.name,new g(h,f)),this}}(jQuery,window,document);