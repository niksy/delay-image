/*! kist-delayImages 0.3.5 - Delay images via postpone or lazyload. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a,b){function c(a){return"object"==typeof a?a:{}}function d(a){return"postpone"===a.method?l?e:f:e}function e(b,c){this.element=b,this.options=a.extend({},this.defaults,c),j.setup.call(this),k.setup.call(this),i.setup.call(this),this.parse(this.dom.el)}function f(){f._super.constructor.apply(this,arguments)}function g(){}var h={name:"delayImages",ns:{css:"kist-DelayImages",event:".kist.delayImages"},error:function(a){throw new Error(h.name+": "+a)}};h.classes={image:h.ns.css+"-image",isLoading:"is-loading",isLoaded:"is-loaded"},h.publicMethods=["destroy"];var i={setup:function(){this.dom=this.dom||{},this.dom.el=a(this.element),this._element=this.dom.el.toArray(),this.dom.el.addClass(h.classes.image)},destroy:function(){a.each(h.classes,a.proxy(function(a,b){this.dom.el.removeClass(b)},this))}},j={id:0,setup:function(){this.instance=this.instance||{},this.instance.id=j.id++,this.instance.ens=h.ns.event+"."+this.instance.id},destroy:function(){this.dom.el.each(function(b,c){delete a.data(c)[h.name]})}},k={setup:function(){this.aux=this.aux||{},this.aux.loadImage=a.kist.loader.loadImage}},l="Modernizr"in b&&Modernizr.proxybrowser||/Opera Mini|Silk/i.test(navigator.userAgent);a.extend(e.prototype,{parse:function(c){var d=[],e=a.Deferred();return c.addClass(h.classes.isLoading),c.each(a.proxy(function(b,c){c=a(c),d.push(this.aux.loadImage(c.data("src"))),d[d.length-1].always(a.proxy(this.success,this,c))},this)),a.when.apply(b,d).always(e.resolve),e.promise()},success:function(a){a.attr({src:a.data("src"),alt:a.data("alt")}).removeClass(h.classes.isLoading).addClass(h.classes.isLoaded)},destroy:function(){i.destroy.call(this),j.destroy.call(this)}}),g.prototype=e.prototype,f.prototype=new g,f.prototype.constructor=f,f._super=e.prototype,a.extend(f.prototype,{parse:function(b){b.inView({threshold:this.options.threshold,debounce:this.options.debounce,once:a.proxy(function(b){this.options.start&&this.options.start.call(this._element,b),f._super.parse.call(this,b).done(a.proxy(function(){this.options.success&&this.options.success.call(this._element,b)},this))},this)})},destroy:function(){f._super.destroy.call(this),this.dom.el.inView("destroy")},defaults:{threshold:0,debounce:300,success:null,start:null}}),a.kist=a.kist||{},a.kist[h.name]={postpone:{defaults:f.prototype.defaults}},a.fn[h.name]=function(b){if("string"==typeof b&&-1!==a.inArray(b,h.publicMethods))return this.each(function(){var c=a.data(this,h.name);c&&c[b]()});b=c(b);var e=d(b),f=this.filter(function(){return!a.data(this,h.name)&&a(this).is("img")});return f.length&&f.data(h.name,new e(f,b)),this}}(jQuery,window,document);