/*! kist-delayImages 0.3.7 - Delay images via postpone or lazyload. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a,b){function c(a){return"object"==typeof a?a:{}}function d(a){return"postpone"===a.method?m?f:g:f}function e(a){this.options.success.call(this._element,a)}function f(b,c){this.element=b,this.options=a.extend({},this.defaults,c),k.setup.call(this),l.setup.call(this),j.setup.call(this),this.parse(this.dom.el).done(a.proxy(this._init,this))}function g(){g._super.constructor.apply(this,arguments)}function h(){}var i={name:"delayImages",ns:{css:"kist-DelayImages",event:".kist.delayImages"},error:function(a){throw new Error(i.name+": "+a)}};i.classes={image:i.ns.css+"-image",isLoading:"is-loading",isLoaded:"is-loaded"},i.publicMethods=["destroy"];var j={setup:function(){this.dom=this.dom||{},this.dom.el=a(this.element),this._element=this.dom.el.toArray(),this.dom.el.addClass(i.classes.image)},destroy:function(){a.each(i.classes,a.proxy(function(a,b){this.dom.el.removeClass(b)},this))}},k={id:0,setup:function(){this.instance=this.instance||{},this.instance.id=k.id++,this.instance.ens=i.ns.event+"."+this.instance.id},destroy:function(){this.dom.el.each(function(b,c){delete a.data(c)[i.name]})}},l={setup:function(){this.aux=this.aux||{},this.aux.loadImage=a.kist.loader.loadImage}},m="Modernizr"in b&&Modernizr.proxybrowser||/Opera Mini|Silk/i.test(navigator.userAgent);a.extend(f.prototype,{_init:function(a){e.call(this,a)},parse:function(c){this.options.start.call(this._element,c);var d=[],e=a.Deferred();return c.addClass(i.classes.isLoading),c.each(a.proxy(function(b,c){c=a(c),d.push(this.aux.loadImage(c.data("src"))),d[d.length-1].always(a.proxy(this.success,this,c))},this)),a.when.apply(b,d).always(function(){e.resolve(c)}),e.promise()},success:function(a){a.attr({src:a.data("src"),alt:a.data("alt")}).removeClass(i.classes.isLoading).addClass(i.classes.isLoaded)},destroy:function(){j.destroy.call(this),k.destroy.call(this)},defaults:{success:function(){},start:function(){}}}),h.prototype=f.prototype,g.prototype=new h,g.prototype.constructor=g,g._super=f.prototype,a.extend(g.prototype,{_init:function(){},parse:function(b){return b.inView({threshold:this.options.threshold,debounce:this.options.debounce,once:a.proxy(function(b){g._super.parse.call(this,b).done(a.proxy(e,this))},this)}),a.Deferred().resolve().promise()},destroy:function(){g._super.destroy.call(this),this.dom.el.inView("destroy")},defaults:a.extend({},g._super.defaults,{threshold:0,debounce:300})}),a.kist=a.kist||{},a.kist[i.name]={postpone:{defaults:g.prototype.defaults}},a.fn[i.name]=function(b){if("string"==typeof b&&-1!==a.inArray(b,i.publicMethods))return this.each(function(){var c=a.data(this,i.name);c&&c[b]()});b=c(b);var e=d(b),f=this.filter(function(){return!a.data(this,i.name)&&a(this).is("img")});return f.length&&f.data(i.name,new e(f,b)),this}}(jQuery,window,document);