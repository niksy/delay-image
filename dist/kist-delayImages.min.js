/*! kist-delayImages 0.3.1 - Delay images via postpone or lazyload. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a){function b(b,c){var d={};switch(typeof b){case"string":d.method=b;break;case"object":a.extend(d,b);break;default:d.method="lazyload"}switch(typeof c){case"object":a.extend(d,c);break;case"function":d.success=c}return d}function c(a){switch(a.method){case"lazyload":return e;case"postpone":return f;default:h.error('Unsupported method "'+a.method+'".')}}function d(a){switch(a.method){case"lazyload":a={};break;case"postpone":delete a.method}return a}function e(b,c){this.element=b,this.options=a.extend({},this.defaults,c),j.setup.call(this),k.setup.call(this),i.setup.call(this),this.parse(this.dom.el)}function f(){f._super.constructor.apply(this,arguments)}function g(){}var h={name:"delayImages",ns:{css:"kist-DelayImages",event:".kist.delayImages"},error:function(a){throw new Error(h.name+": "+a)}};h.classes={image:h.ns.css+"-image",isLoading:"is-loading",isLoaded:"is-loaded"},h.publicMethods=["destroy"];var i={setup:function(){this.dom=this.dom||{},this.dom.el=a(this.element),this.dom.el.addClass(h.classes.image)}},j={id:0,setup:function(){this.instance=this.instance||{},this.instance.id=j.id++,this.instance.ens=h.ns.event+"."+this.instance.id},destroy:function(){this.dom.el.each(function(b,c){delete a.data(c)[h.name],delete a.data(c)[h.name+"-inView"]})}},k={setup:function(){this.aux=this.aux||{},this.aux.loadImage=a.proxy(a.kist.loader.loadImage,a.kist.loader)}};a.extend(e.prototype,{parse:function(b){b.each(a.proxy(function(b,c){c=a(c),c.addClass(h.classes.isLoading),this.aux.loadImage(c.data("src")).done(a.proxy(this.onParse,this,c))},this))},onParse:function(a){a.attr({src:a.data("src"),alt:a.data("alt")}).removeAttr("width height").removeClass(h.classes.isLoading).addClass(h.classes.isLoaded)},destroy:function(){j.destroy.call(this)}}),g.prototype=e.prototype,f.prototype=new g,f.prototype.constructor=f,f._super=e.prototype,a.extend(f.prototype,{parse:function(b){this.remaining=b.length,b.inView({threshold:this.options.threshold,debounce:this.options.debounce,success:a.proxy(function(a){return 0===this.remaining?void this.destroy():(this.options.success&&this.options.success.call(null,a),void f._super.parse.call(this,a))},this)})},onParse:function(a){f._super.onParse.apply(this,arguments),a.data(h.name+"-inView")||(a.data(h.name+"-inView",!0),this.remaining--)},destroy:function(){f._super.destroy.call(this),this.dom.el.inView("destroy")},defaults:{threshold:0,debounce:300}}),a.kist=a.kist||{},a.kist[h.name]={postpone:{defaults:f.prototype.defaults}},a.fn[h.name]=function(e,f){var g;return"string"==typeof e&&-1!==a.inArray(e,h.publicMethods)?this.each(function(){var b=a.data(this,h.name);b&&b[e]()}):(f=b(e,f),g=c(f),f=d(f),this.filter(function(b){return!a.data(b,h.name)}).data(h.name,new g(this,f)),this)}}(jQuery,window,document);